<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoAwAAFgAAACgAAAAQAAAAIAAAAAEAGAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwAAAMHBSguIewvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwvIusvIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwvIusvIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwvIesvIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjGbEvIuwvIuwvIuwvIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwpHtQvIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwvIuw1J+wvIuwvIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwvIuwcFJQAAAAQCk8vIuwvIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwAAAAeNRJoh1ZSjS1uZe0vIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAvIuwvIuwvIuwAAABDdCUBAQBRjCwLCDovIuwvIuwvIuwAAAAAAAAAAAAAAAAAAAAsIOAvIuwvIuwvIuxSjS0pRhYHCg4vIuwvIuwvIuwuIecAAAAAAAAAAAAAAAAAAAAAAAAkGtgvIuwvIuwvIusvIuwvIuwvIuwvIuwFAxkOC00AAAAAAAAAAAAAAAAAAAAAAAAvIuwjGrsvIuwuIekvIuwuJOQqHtcDAg8vIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwOCkovIuwvIuwvIuwvIuwvIuwvIuwRDGAAAAAAAAAAAAAAAAAAAAAAAAAvIuwvIuwkGrgvIuwvIuwcFI0vIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIBi0vIuwvIuwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADxnwAA8B8AAPAfAADwHwAA8B8AAPAfAADgDwAAw4cAAMcHAADFRwAAwYcAAOAfAADgJwAA5A8AAOCfAAD8/wAA" />
    <link rel="stylesheet" type="text/css" href="/css/stack.css">
    <link rel="stylesheet" type="text/css" href="/css/webfonts.css">
    <link rel="stylesheet" type="text/css" href="/css/base.css">
    <link rel="stylesheet" type="text/css" href="css/presentation.css">

    <script src="/js/highlight-8.0.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/solarized_dark.css">

    <script src="/js/jquery-2.1.1.js"></script>
    <script src="/js/underscore-1.6.0.js"></script>
    <script src="/js/async.js"></script>
  </head>
  <body>
    <section class="center">
      <h1>Async JavaScript</h1>
      <h2>Evan Savage</h2>
      <div class="contact">
        <img src="/img/github.png"></img>
        <a href="https://github.com/candu">candu</a>
      </div>
      <div class="contact">
        <img src="/img/twitter.png"></img>
        <a href="https://twitter.com/candusavage">@candusavage</a>
      </div>
    </section>
    <section class="chapter center">
      <h1>i said right this second!</h1>
    </section>
    <section>
      <blockquote>
        The minimum delay, DOM_MIN_TIMEOUT_VALUE, is 4 ms...the timeout can also fire later
        when the page (or the OS/browser itself) is busy with other tasks.
        <footer>
          &ndash; <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.setTimeout">MDN - window.setTimeout</a>
        </footer>
      </blockquote>
    </section>
    <section class="center">
      <div class="title">the minimum timeout is &gt;0 ms</div>
      <pre><code data-code-target="#js_min_timeout"></code></pre>
      <button id="btn_min_timeout">run it!</button>
      <script id="js_min_timeout">
  $('#btn_min_timeout').click(function() {
    var start = new Date();
    window.setTimeout(function() {
      var elapsed = new Date() - start;
      alert('elapsed: ' + elapsed + ' ms');
    }, 0);
  });
      </script>
    </section>
    <section class="center">
      <div class="title">yes, this applies to setInterval()</div>
      <pre><code data-code-target="#js_timer_resolution"></code></pre>
      <button id="btn_timer_resolution">run it!</button>
      <script id="js_timer_resolution">
  $('#btn_timer_resolution').click(function() {
    var start = new Date(), numCalls = 0;
    var interval = window.setInterval(function() {
      if (new Date() - start >= 1000) {
        window.clearInterval(interval);
        alert('numCalls: ' + numCalls);
      }
      numCalls++;
    }, 0);
  });
      </script>
    </section>
    <section class="center">
      <div class="title">the postMessage() trick</div>
      <pre><code data-code-target="#js_post_message"></code></pre>
      <script id="js_post_message">
  (function() {
    var callbacks = [];
    window.addEventListener('message', function(event) {
      if (event.source == window && event.data == '__zero_timeout__') {
        event.stopPropagation();
        if (callbacks.length > 0) (callbacks.shift())();
      }
    }, true);
    window.setZeroTimeout = function(callback) {
      callbacks.push(callback);
      window.postMessage('__zero_timeout__', '*');
    };
  })();
      </script>
    </section>
    <section class="center">
      <div class="title">the postMessage() trick in action</div>
      <pre><code data-code-target="#js_post_message_action"></code></pre>
      <button id="btn_post_message_action">run it!</button>
      <script id="js_post_message_action">
  $('#btn_post_message_action').click(function() {
    var start = new Date(), numCalls = 0;
    function callback() {
      if (new Date() - start >= 1000) {
        return alert('numCalls: ' + numCalls);
      }
      numCalls++;
      window.setZeroTimeout(callback);
    }
    window.setZeroTimeout(callback);
  });
      </script>
    </section>
    <section class="center">
      <div class="title">events wait their turn</div>
      <pre><code data-code-target="#js_timeout_waiting"></code></pre>
      <button id="btn_timeout_waiting">run it!</button>
      <script id="js_timeout_waiting">
  $('#btn_timeout_waiting').click(function() {
    var start = new Date();
    window.setTimeout(function() {
      var elapsed = new Date() - start;
      alert('elapsed: ' + elapsed + ' ms');
    }, 0);
    while (new Date() - start < 1000) {}  // busy wait...
  });
      </script>
    </section>
    <section class="center">
      <div class="title">DOM updates wait their turn</div>
      <pre><code data-code-target="#js_dom_waiting"></code></pre>
      <button id="btn_dom_waiting">run it!</button>
      <script id="js_dom_waiting">
  $('#btn_dom_waiting').click(function() {
    $('#btn_dom_waiting').css('background-color', '#f00');
    var start = new Date();
    while (new Date() - start < 1000) {}  // busy wait...
    $('#btn_dom_waiting').css('background-color', '#ff0');
  });
      </script>
    </section>
    <section class="center">
      <div class="title">the setTimeout(..., 0) trick</div>
      <pre><code data-code-target="#js_dom_waiting_fixed"></code></pre>
      <button id="btn_dom_waiting_fixed">run it!</button>
      <script id="js_dom_waiting_fixed">
  $('#btn_dom_waiting_fixed').click(function() {
    $('#btn_dom_waiting_fixed').css('background-color', '#f00');
    var start = new Date();
    window.setTimeout(function() {
      while (new Date() - start < 1000) {}  // busy wait...
      $('#btn_dom_waiting_fixed').css('background-color', '#ff0');
    }, 0);
  });
      </script>
    </section>
    <section class="center">
      <div class="title">events are queued, part 1</div>
      <pre><code data-code-target="#js_event_queue"></code></pre>
      <button id="btn_event_queue">run it!</button>
      <div id="output_event_queue"></div>
      <script id="js_event_queue">
  $('#btn_event_queue').click(function() {
    $('#output_event_queue').empty();
    _.each(_.range(10), function(i) {
      window.setTimeout(function() {
        var start = new Date(), wait = Math.floor(200 * Math.random());
        while (new Date() - start < wait) {}  // busy wait...
        $('<span />').text(i).appendTo($('#output_event_queue'));
      }, 0);
    })
  });
      </script>
    </section>
    <section class="center">
      <div class="title">events are queued, part 2</div>
      <pre><code data-code-target="#js_event_queue_fixed"></code></pre>
      <button id="btn_event_queue_fixed">run it!</button>
      <div id="output_event_queue_fixed"></div>
      <script id="js_event_queue_fixed">
  $('#btn_event_queue_fixed').click(function() {
    $('#output_event_queue_fixed').empty();
    _.each(_.range(10), function(i) {
      var wait = Math.floor(200 * Math.random());
      window.setTimeout(function() {
        var start = new Date();
        $('<span />').text(i).appendTo($('#output_event_queue_fixed'));
      }, wait);  // timeout wait...
    })
  });
      </script>
    </section>
    <section class="center">
      <h2>JavaScript is <strong>NOT</strong> concurrent!</h2>
    </section>
    <section class="chapter center">
      <h1>i'll have my people call your people</h1>
    </section>
    <section class="center">
      <div class="title">$.ajax(), old-style</div>
      <pre><code data-code-target="#js_ajax_old_style"></code></pre>
      <button id="btn_ajax_old_style">run it!</button>
      <script id="js_ajax_old_style">
  function alertJSON(value) {
    alert(JSON.stringify(value));
  }
  $('#btn_ajax_old_style').click(function() {
    $.getJSON('json/a.json', alertJSON);
  });
      </script>
    </section>
    <section class="center">
      <div class="title">the pyramid of doom</div>
      <pre><code data-code-target="#js_pyramid_of_doom"></code></pre>
      <button id="btn_pyramid_of_doom">run it!</button>
      <script id="js_pyramid_of_doom">
  $('#btn_pyramid_of_doom').click(function() {
    $.getJSON('json/a.json', function(a) {
      $.getJSON('json/b.json', function(b) {
        $.getJSON('json/c.json', function(c) {
          alertJSON([a, b, c]);
        });
      });
    });
  });
      </script>
    </section>
    <section class="center">
      <div class="title">named callbacks</div>
      <pre><code data-code-target="#js_named_callbacks"></code></pre>
      <button id="btn_named_callbacks">run it!</button>
      <script id="js_named_callbacks">
  function a(doneA, doneB) {
    $.getJSON('json/a.json', function(a) { doneA(a, doneB); }); }
  function b(a, doneB) {
    $.getJSON('json/b.json', function(b) { doneB(a, b); }); }
  function c(a, b) {
    $.getJSON('json/c.json', function(c) {
      alertJSON([a, b, c]);
    }); }
  $('#btn_named_callbacks').click(function() { a(b, c) });
      </script>
    </section>
    <section class="center">
      <div class="title">DIY series execution</div>
      <pre><code data-code-target="#js_series_execution"></code></pre>
      <button id="btn_series_execution">run it!</button>
      <script id="js_series_execution">
  var urls = _.map('abc', function(x) { return 'json/' + x + '.json'; });

  function series(urls, done) {
    if (urls.length === 0) done([]);
    $.getJSON(urls[0], function(first) {
      series(urls.slice(1), function(rest) {
        done([first].concat(rest)); }); }); };
  $('#btn_series_execution').click(function() {
    series(urls, alertJSON) });
      </script>
    </section>
    <section class="center">
      <div class="title">DIY parallel execution</div>
      <pre><code data-code-target="#js_parallel_execution"></code></pre>
      <button id="btn_parallel_execution">run it!</button>
      <script id="js_parallel_execution">
  function parallel(urls, done) {
    if (urls.length === 0) { done([]); }
    var numDone = 0, n = urls.length, results = new Array(n);
    _.each(urls, function(url, i) {
      $.getJSON(url, function(result) {
        results[i] = result;
        if (++numDone === n) done(results); }); }); }
  $('#btn_parallel_execution').click(function() {
    parallel(urls, alertJSON); });
      </script>
    </section>
    <section class="chapter center">
      <h1>everything but the kitchen async</h1>
    </section>
    <section class="center">
      <div class="title">node-style callbacks</div>
      <pre><code data-code-target="#js_node_callbacks"></code></pre>
      <button id="btn_node_callbacks">run it!</button>
      <script id="js_node_callbacks">
  function task(url) {
    return function(callback) {
      $.getJSON(url, function(result) { callback(null, result); });
    };
  }
  $('#btn_node_callbacks').click(function() {
    task('json/a.json')(function(err, a) { alertJSON(a); });
  });
      </script>
    </section>
    <section class="center">
      <div class="title">async.series()</div>
      <pre><code data-code-target="#js_series_async"></code></pre>
      <button id="btn_series_async">run it!</button>
      <script id="js_series_async">
  $('#btn_series_async').click(function() {
    async.series(_.map(urls, task), function(err, abc) {
      alertJSON(abc);
    });
  });
      </script>
    </section>
    <section class="center">
      <div class="title">async.parallel()</div>
      <pre><code data-code-target="#js_parallel_async"></code></pre>
      <button id="btn_parallel_async">run it!</button>
      <script id="js_parallel_async">
  $('#btn_parallel_async').click(function() {
    async.parallel(_.map(urls, task), function(err, abc) {
      alertJSON(abc);
    });
  });
      </script>
    </section>
    <section class="chapter center">
      <h1>i'll be back, i promise</h1>
    </section>
    <section class="center">
      <div class="title">$.ajax(), new-style</div>
      <pre><code data-code-target="#js_ajax_new_style"></code></pre>
      <button id="btn_ajax_new_style">run it!</button>
      <script id="js_ajax_new_style">
  /* old-style:
   *
   * $.getJSON('json/a.json', function(a) {
   *   alert(JSON.stringify(a));
   * });
   */
  $('#btn_ajax_new_style').click(function() {
    $.getJSON('json/a.json').done(alertJSON);
  });
      </script>
    </section>
    <section class="center">
      <div class="title">deferreds and promises</div>
      <pre><code data-code-target="#js_deferreds"></code></pre>
      <button id="btn_deferreds">run it!</button>
      <script id="js_deferreds">
  function getJsonNew(url) {
    var d = new $.Deferred();
    $.getJSON(url, d.resolve.bind(d));
    return d.promise();
  }
  $('#btn_deferreds').click(function() {
    getJsonNew('json/a.json').done(alertJSON);
  });
      </script>
    </section>
    <section class="chapter center">
      <h1>event planning</h1>
    </section>
    <section class="chapter center">
      <h1>alright, i yield!</h1>
    </section>
    <section class="chapter center">
      <h1>further reading</h1>
    </section>
    <section class="center">
      <h1>Async JavaScript</h1>
      <h2>Evan Savage</h2>
      <div class="contact">
        <img src="/img/github.png"></img>
        <a href="https://github.com/candu">candu</a>
      </div>
      <div class="contact">
        <img src="/img/twitter.png"></img>
        <a href="https://twitter.com/candusavage">@candusavage</a>
      </div>
    </section>
    <!-- stack.js -->
    <script src="/js/d3.js?2.7.3"></script>
    <script src="/js/stack.js"></script>
    <!-- highlighting -->
    <script>
    $(document).ready(function() {
      $('pre > code').each(function(i, block) {
        var codeTarget = $(block).data('codeTarget');
        $(block).text($(codeTarget).html());
        hljs.highlightBlock(block);
      });
    });
    </script>
  </body>
</html>
